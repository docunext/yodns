#!/usr/bin/env ruby

require 'rubygems'
require 'lib/yodns'
require 'trollop'
require 'terminal-table/import'

SUB_COMMANDS = %w(zones list records add show export)
global_opts = Trollop::options do
  banner <<-EOS
 
 YoDNSConf.com
 =============

Command Line Zonefile management tool

Usage
-----

    yodns zones

    yodns show <zone>
    yodns list [--type] <zone>
    yodns add <zone> <type> <name> <host> [ttl]

where [options] are:
EOS
  opt :dry_run, "Don't actually do anything", :short => "-n"
  opt :verbose, "Increase verbosity", :short => "-v"
  stop_on SUB_COMMANDS
end

# yodns add yodnsconf.com www www-c.evenserver.com.
# yodns list --record=txt yodnsconf.com

cmd = ARGV.shift # get the subcommand
z = YoDns.new

case cmd
  when "zones"
    #
  when "list"
    cmd_opts = Trollop::options do
      opt :type, "Record type", :default => 'a', :short => '-t'
    end

    z.list_zone_records ARGV.shift, cmd_opts[:type]

  when "add"
    cmd_opts = Trollop::options do
      opt :ttl, "Time-to-live", :default => 14400, :short => '-t'
      opt :save, "Save"
    end

    ARGV << cmd_opts[:ttl]
    zone = z.add_zone_record(ARGV.shift, ARGV.shift, ARGV )  

  when "show"

    puts z.load_zone(ARGV.shift).output

  when "export"
    #
  else
    Trollop::die "unknown subcommand #{cmd.inspect}"
  end


if global_opts[:verbose]
  puts "Global options: #{global_opts.inspect}"
  puts "Subcommand: #{cmd.inspect}"
  puts "Subcommand options: #{cmd_opts.inspect}"
  puts "Remaining arguments: #{ARGV.inspect}"
end
